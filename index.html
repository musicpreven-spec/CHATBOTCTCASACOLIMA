<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Chatbot Casa Colima ‚Äî Especialista</title>
<style>
  :root{
    --accent:#28a6a6;
    --bg:#eaf6f5;
    --chat-bg:#ffffff;
    --bot-bubble:#f1fdfd;
    --user-bubble:#dcf8c6;
    --muted:#6f7b7b;
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  }
  html,body{height:100%;margin:0;background:var(--bg);display:flex;align-items:center;justify-content:center;padding:18px;}
  .chat-wrap{width:380px;height:700px;border-radius:14px;box-shadow:0 12px 40px rgba(10,10,10,.12);background:var(--chat-bg);display:flex;flex-direction:column;overflow:hidden;border:1px solid rgba(0,0,0,.04);}
  .header{display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid rgba(0,0,0,.04);background:linear-gradient(90deg, rgba(40,166,166,0.06), rgba(120,120,170,0.03));}
  .avatar-wrap{width:54px;height:54px;border-radius:50%;position:relative;flex:0 0 54px;overflow:visible;}
  .avatar{
    width:54px;height:54px;border-radius:50%;overflow:hidden;border:2px solid rgba(0,0,0,.04);
    box-shadow:0 2px 6px rgba(0,0,0,.06);transform-origin:center center;transition:transform .28s ease;
    position:relative;background:#fff;
  }
  .avatar img{width:100%;height:100%;object-fit:cover;display:block;user-select:none}
  .eyelid{
    position:absolute;left:0;right:0;top:0;height:0;background:rgba(234,246,244,0.95);pointer-events:none;transition:height .12s linear;border-bottom-left-radius:50%;border-bottom-right-radius:50%;
  }
  .smile{
    position:absolute;left:50%;bottom:10px;width:40%;height:8px;transform:translateX(-50%);border-radius:999px;opacity:0;transition:opacity .18s ease;
    box-shadow:0 2px 0 rgba(0,0,0,.06) inset;
  }
  .avatar.tilt { transform: rotate(-4deg) translateY(-2px); }
  .avatar.nod { transform: translateY(2px) scale(.995); }

  .title{font-weight:600;color:#0b5161;}
  .subtitle{font-size:12px;color:var(--muted);margin-top:2px;}

  .messages{
    flex:1;padding:16px;display:flex;flex-direction:column;gap:12px;overflow:auto;
    background-image:
      radial-gradient(circle at 10% 10%, rgba(0,0,0,0.02) 0.5px, transparent 0.6px),
      linear-gradient(transparent 0 40px, rgba(255,255,255,0.6) 40px);
    background-size: 22px 22px, 100% 100%;
  }

  .bubble{max-width:78%;padding:10px 12px;border-radius:18px;line-height:1.35;font-size:14px;box-shadow:0 1px 0 rgba(0,0,0,.02);position:relative;}
  .bot{align-self:flex-start;background:var(--bot-bubble);border-top-left-radius:6px;margin-left:6px;}
  .bot::after{
    content:"";position:absolute;left:-6px;bottom:8px;width:12px;height:12px;background:var(--bot-bubble);transform:rotate(45deg);border-bottom-left-radius:2px;border-top-right-radius:2px;z-index:-1;
  }
  .user{align-self:flex-end;background:var(--user-bubble);border-top-right-radius:6px;margin-right:6px;}
  .user::after{
    content:"";position:absolute;right:-6px;bottom:8px;width:12px;height:12px;background:var(--user-bubble);transform:rotate(45deg);z-index:-1;border-bottom-right-radius:2px;border-top-left-radius:2px;
  }

  .meta{font-size:11px;color:var(--muted);margin-top:6px}

  .thinking-bubble{display:inline-flex;gap:6px;align-items:center;padding:8px 10px;border-radius:14px;background:#eef7f7;}
  .dots span{display:inline-block;width:6px;height:6px;border-radius:50%;background:#6fb9b9;animation:dot 1s infinite}
  .dots span:nth-child(2){animation-delay:.12s}
  .dots span:nth-child(3){animation-delay:.24s}
  @keyframes dot{0%{transform:translateY(0)}50%{transform:translateY(-5px)}100%{transform:translateY(0)}}

  .reaction{display:inline-block;margin-left:8px;transform-origin:center;animation:pop .45s ease;-webkit-font-smoothing:antialiased}
  @keyframes pop{0%{transform:scale(.2) rotate(-10deg);opacity:0}60%{transform:scale(1.1) rotate(6deg);opacity:1}100%{transform:scale(1) rotate(0deg)}}

  .controls{padding:12px;border-top:1px solid rgba(0,0,0,.04);display:flex;gap:8px;align-items:center;background:#fff;}
  .input{flex:1;display:flex;gap:8px;align-items:center;background:#fbfffe;padding:8px;border-radius:999px;border:1px solid rgba(0,0,0,.04);}
  .input input{border:0;outline:none;background:transparent;font-size:14px;width:100%;}
  .btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600;}

  .quick-options{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;}
  .chip{background:#f3fbfb;padding:6px 8px;border-radius:18px;font-size:13px;border:1px solid rgba(0,0,0,.03);cursor:pointer}

  @media (max-width:420px){ .chat-wrap{width:100%;height:92vh} }

</style>
</head>
<body>
  <div class="chat-wrap" role="application" aria-label="Chatbot Casa Colima">
    <div class="header">
      <div class="avatar-wrap" aria-hidden="true">
        <div class="avatar" id="avatar">
          <!-- Cambia 'avatar.png' por tu imagen real -->
          <img id="avatarImg" src="avatar.png" alt="Avatar del especialista de Casa Colima">
          <div class="eyelid" id="eyelid"></div>
          <div class="smile" id="smile" style="background:linear-gradient(90deg, rgba(0,0,0,0.06), rgba(0,0,0,0.04));"></div>
        </div>
      </div>
      <div>
        <div class="title">Casa Colima ‚Äî Especialista</div>
        <div class="subtitle">Experto en salud mental y adicciones ¬∑ ü§ù Empat√≠a</div>
      </div>
    </div>

    <div class="messages" id="msgs" tabindex="0" aria-live="polite">
    </div>

    <div class="controls">
      <div class="input" role="search" aria-label="Escribe un mensaje">
        <input id="userInput" placeholder="Escribe un mensaje..." aria-label="Mensaje">
      </div>
      <button class="btn" id="sendBtn" aria-label="Enviar">Enviar</button>
    </div>
  </div>

<script>
const msgs = document.getElementById('msgs');
const input = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const avatar = document.getElementById('avatar');
const eyelid = document.getElementById('eyelid');
const smile = document.getElementById('smile');

function scrollBottom(){ msgs.scrollTop = msgs.scrollHeight; }

function appendBot(html, opts = {}) {
  const bubble = document.createElement('div');
  bubble.className = 'bubble bot';
  bubble.innerHTML = html;
  if (opts.reaction) {
    const span = document.createElement('span'); span.className='reaction'; span.textContent = opts.reaction;
    bubble.appendChild(span);
  }
  msgs.appendChild(bubble);
  scrollBottom();
}
function appendUser(text) {
  const bubble = document.createElement('div'); bubble.className='bubble user'; bubble.textContent = text;
  msgs.appendChild(bubble); scrollBottom();
}
function showThinkingBubble(){
  const wrap = document.createElement('div');
  wrap.className = 'bot-row';
  const thinking = document.createElement('div'); thinking.className='thinking-bubble';
  const dots = document.createElement('span'); dots.className='dots';
  dots.innerHTML = '<span></span><span></span><span></span>';
  thinking.textContent = ''; thinking.appendChild(dots);
  wrap.appendChild(thinking);
  msgs.appendChild(wrap); scrollBottom();
  return wrap;
}

let blinkTimer = null;
function doBlinkOnce(duration=140){
  eyelid.style.height = '100%';
  setTimeout(()=> eyelid.style.height = '0', duration);
}
function startAutoBlink(){
  if (blinkTimer) clearInterval(blinkTimer);
  blinkTimer = setInterval(()=> doBlinkOnce(), 6000 + Math.random()*4000);
}
function stopAutoBlink(){ if (blinkTimer) clearInterval(blinkTimer); blinkTimer=null; eyelid.style.height='0'; }

function setAvatarState(state){
  avatar.classList.remove('tilt','nod');
  smile.style.opacity = '0';
  if (state === 'idle'){ }
  else if (state === 'blink'){ doBlinkOnce(); }
  else if (state === 'thinking'){ avatar.classList.add('tilt'); doBlinkOnce(); setTimeout(()=> { avatar.classList.remove('tilt'); }, 1400); }
  else if (state === 'smile'){ smile.style.opacity = '1'; avatar.animate([{transform:'scale(1)'},{transform:'scale(1.02)'},{transform:'scale(1)'}],{duration:360}); setTimeout(()=> smile.style.opacity='0', 1400); }
  else if (state === 'nod'){ avatar.classList.add('nod'); setTimeout(()=> avatar.classList.remove('nod'), 700); }
  else if (state === 'focus'){ avatar.animate([{transform:'scale(1)'},{transform:'scale(1.06)'}],{duration:220,fill:'forwards'}); setTimeout(()=> avatar.style.transform='scale(1)', 700); }
}

function botReplySimulated(text, opts = {}) {
  setAvatarState('thinking');
  const thinking = showThinkingBubble();
  setTimeout(()=> {
    thinking.remove();
    appendBot(text, opts);
    setAvatarState('smile');
  }, 900 + Math.min(1200, Math.max(0, text.length*12)));
}

function startChat(){
  appendBot('<strong>Hola ‚Äî soy el especialista de Casa Colima.</strong><br>¬øEn qu√© te puedo ayudar hoy?');
  const wrapper = document.createElement('div'); wrapper.style.marginTop='8px';
  const chips = document.createElement('div'); chips.className='quick-options';
  ['Problemas de adicci√≥n','Buscar apoyo','Contacto','Recursos inmediatos'].forEach(opt => {
    const b = document.createElement('button'); b.className='chip'; b.textContent = opt;
    b.onclick = ()=> {
      appendUser(opt);
      setAvatarState('nod');
      if (opt === 'Problemas de adicci√≥n') botReplySimulated('Siento que est√©s pasando por eso. ¬øQu√© sustancia te preocupa o afecta a alguien cercano?', {reaction:'‚ö†Ô∏è'});
      else if (opt === 'Buscar apoyo') botReplySimulated('Puedo ayudarte a encontrar grupos de apoyo y terapia presencial o en l√≠nea. ¬øQu√© prefieres?');
      else if (opt === 'Contacto') botReplySimulated('Tel: 55 1234 5678 ¬∑ correo: contacto@casacolima.mx');
      else botReplySimulated('Te env√≠o t√©cnicas breves para manejar ansiedad y craving. ¬øPor cu√°l v√≠a prefieres recibirlas?');
    };
    chips.appendChild(b);
  });
  wrapper.appendChild(chips);
  msgs.appendChild(wrapper);
  scrollBottom();
}

sendBtn.addEventListener('click', ()=> {
  const val = input.value.trim();
  if(!val) return;
  appendUser(val);
  input.value='';
  setAvatarState('focus');
  const thinking = showThinkingBubble();
  setTimeout(()=> {
    thinking.remove();
    if(/adicci|droga|cristal|alcohol|hero√≠na|coca√≠na/i.test(val)){
      appendBot('Gracias por compartir. ¬øHay riesgo f√≠sico inmediato? (si/no)');
    } else if (/gracias|ok|vale|perfecto/i.test(val)){
      appendBot('Me alegra ser de ayuda. ¬øDeseas que reserve una sesi√≥n o te env√≠o recursos?', {reaction:'üòä'});
    } else {
      appendBot('Entiendo. ¬øDeseas que te ofrezca recursos, un contacto o agende una llamada?');
    }
    setAvatarState('smile');
  }, 900 + Math.random()*600);
});
input.addEventListener('keydown', (e)=> { if(e.key === 'Enter'){ e.preventDefault(); sendBtn.click(); } });

startAutoBlink();
startChat();

window.chatbotAvatar = { setAvatarState };
</script>
</body>
</html>